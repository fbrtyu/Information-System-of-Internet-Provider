{"ast":null,"code":"import _slicedToArray from\"C:/Users/admin/Desktop/\\u0414\\u043E\\u043A\\u0443\\u043C\\u0435\\u043D\\u0442\\u044B/123123/GW/Information-System-of-Internet-Provider/SiteReact/gg/app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import ReactDOMClient from\"react-dom/client\";import React,{useState,useRef,useEffect,useCallback}from\"react\";import Hls from\"hls.js\";import{gc}from'./userpage.js';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var AppWs=function AppWs(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isPaused=_useState2[0],setIsPaused=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),data=_useState4[0],setData=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),status=_useState6[0],setStatus=_useState6[1];var ws=useRef(null);var clientMessage={username:\"username\",destination:\"destination\",message:\"message\"};useEffect(function(){if(!isPaused){ws.current=new WebSocket(\"ws:localhost:8080/ws\");// создаем ws соединение\nws.current.onopen=function(){return setStatus(\"Соединение открыто\");};// callback на ивент открытия соединения\nws.current.onclose=function(){return setStatus(\"Соединение закрыто\");};// callback на ивент закрытия соединения\ngettingData();}return function(){return ws.current.close();};// кода меняется isPaused - соединение закрывается\n},[ws,isPaused]);var gettingData=useCallback(function(){if(!ws.current)return;ws.current.onmessage=function(e){//подписка на получение данных по вебсокету\nvar a=JSON.parse(e.data,function(key,value){if(key==='username')return new String(value);return value;});setData(a);var chatmess=document.getElementById(\"chatmess\");var newOption=new Option(a.username+\": \"+a.message,\"mess\");chatmess.append(newOption);};});function sm(){clientMessage.username=gc(\"login\");clientMessage.destination=\"Client\";clientMessage.message=document.getElementById(\"bs\").value;ws.current.send(JSON.stringify(clientMessage));}return/*#__PURE__*/_jsx(_Fragment,{children:!!data&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{children:status}),/*#__PURE__*/_jsx(\"video\",{id:\"video\",controls:true}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"button\",{id:\"onstream\",onClick:vvv,children:\"\\u0412\\u043A\\u043B\\u044E\\u0447\\u0438\\u0442\\u044C \\u0442\\u0440\\u0430\\u043D\\u0441\\u043B\\u044F\\u0446\\u0438\\u044E\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){ws.current.close();setIsPaused(!isPaused);},children:!isPaused?'Остановить соединение':'Открыть соединение'}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"p\",{children:[\"\\u0421\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435: \",/*#__PURE__*/_jsx(\"input\",{type:\"text\",size:\"40\",id:\"bs\"})]})}),/*#__PURE__*/_jsx(\"button\",{onClick:sm,children:\"\\u041E\\u0442\\u043F\\u0440\\u0430\\u0432\\u0438\\u0442\\u044C \\u0441\\u043E\\u043E\\u0431\\u0449\\u0435\\u043D\\u0438\\u0435 \\u043D\\u0430 \\u0441\\u0435\\u0440\\u0432\\u0435\\u0440\"}),/*#__PURE__*/_jsx(\"p\",{id:\"chat\",children:\"Chat\"}),/*#__PURE__*/_jsx(\"select\",{id:\"chatmess\",name:\"select\",size:\"10\",multiple:true})]})});function vvv(){if(Hls.isSupported()){var video=document.getElementById('video');var hls=new Hls();hls.lowLatencyMode=true;hls.loadSource('http://192.168.0.171:8080/hls/test.m3u8');hls.attachMedia(video);hls.on(Hls.Events.MANIFEST_PARSED,function(){video.play();});}}};var app=ReactDOMClient.createRoot(document.getElementById(\"app\"));export function VideoChat(){app.render(/*#__PURE__*/_jsx(AppWs,{}));}","map":{"version":3,"names":["ReactDOMClient","React","useState","useRef","useEffect","useCallback","Hls","gc","AppWs","isPaused","setIsPaused","data","setData","status","setStatus","ws","clientMessage","username","destination","message","current","WebSocket","onopen","onclose","gettingData","close","onmessage","e","a","JSON","parse","key","value","String","chatmess","document","getElementById","newOption","Option","append","sm","send","stringify","vvv","isSupported","video","hls","lowLatencyMode","loadSource","attachMedia","on","Events","MANIFEST_PARSED","play","app","createRoot","VideoChat","render"],"sources":["C:/Users/admin/Desktop/Документы/123123/GW/Information-System-of-Internet-Provider/SiteReact/gg/app/src/videochat.js"],"sourcesContent":["import ReactDOMClient from \"react-dom/client\"\r\nimport React, { useState, useRef, useEffect, useCallback } from \"react\";\r\nimport Hls from \"hls.js\";\r\nimport { gc } from './userpage.js'\r\n\r\nconst AppWs = () => {\r\n    const [isPaused, setIsPaused] = useState(false);\r\n    const [data, setData] = useState(null);\r\n    const [status, setStatus] = useState(\"\");\r\n    const ws = useRef(null);\r\n\r\n    var clientMessage = {\r\n        username: \"username\",\r\n        destination: \"destination\",\r\n        message: \"message\"\r\n    }\r\n\r\n    useEffect(() => {\r\n        if (!isPaused) {\r\n            ws.current = new WebSocket(\"ws:localhost:8080/ws\"); // создаем ws соединение\r\n            ws.current.onopen = () => setStatus(\"Соединение открыто\");  // callback на ивент открытия соединения\r\n            ws.current.onclose = () => setStatus(\"Соединение закрыто\"); // callback на ивент закрытия соединения\r\n            gettingData();\r\n        }\r\n\r\n        return () => ws.current.close(); // кода меняется isPaused - соединение закрывается\r\n    }, [ws, isPaused]);\r\n\r\n    const gettingData = useCallback(() => {\r\n        if (!ws.current) return;\r\n\r\n        ws.current.onmessage = e => {//подписка на получение данных по вебсокету\r\n            var a = JSON.parse(e.data, function (key, value) {\r\n                if (key === 'username') return new String(value);\r\n                return value;\r\n            });\r\n            setData(a);\r\n\r\n            let chatmess = document.getElementById(\"chatmess\");\r\n            let newOption = new Option(a.username + \": \" + a.message, \"mess\");\r\n            chatmess.append(newOption);\r\n        };\r\n    });\r\n\r\n    function sm() {\r\n        clientMessage.username = gc(\"login\");\r\n        clientMessage.destination = \"Client\";\r\n        clientMessage.message = document.getElementById(\"bs\").value;\r\n        ws.current.send(JSON.stringify(clientMessage));\r\n    }\r\n\r\n    return (\r\n        <>\r\n            {!!data &&\r\n                <div>\r\n                    <div>\r\n                        <h2>{status}</h2>\r\n                        <video id='video' controls></video>\r\n                        <br></br>\r\n                        <button id=\"onstream\" onClick={vvv}>Включить трансляцию</button>\r\n                    </div>\r\n                    <button onClick={() => {\r\n                        ws.current.close();\r\n                        setIsPaused(!isPaused)\r\n                    }}>{!isPaused ? 'Остановить соединение' : 'Открыть соединение'}</button>\r\n                    <div>\r\n                        <p>Сообщение: <input type=\"text\" size=\"40\" id=\"bs\" /></p>\r\n                    </div>\r\n                    <button onClick={sm}>Отправить сообщение на сервер</button>\r\n                    <p id=\"chat\">Chat</p>\r\n\r\n                    <select id=\"chatmess\" name=\"select\" size=\"10\" multiple>\r\n                    </select>\r\n                </div>\r\n            }\r\n        </>\r\n    )\r\n    function vvv() {\r\n        if (Hls.isSupported()) {\r\n            var video = document.getElementById('video');\r\n            var hls = new Hls();\r\n            hls.lowLatencyMode = true;\r\n            hls.loadSource('http://192.168.0.171:8080/hls/test.m3u8');\r\n            hls.attachMedia(video);\r\n            hls.on(Hls.Events.MANIFEST_PARSED, function () { video.play(); });\r\n        }\r\n    }\r\n}\r\n\r\nconst app = ReactDOMClient.createRoot(document.getElementById(\"app\"))\r\n\r\nexport function VideoChat() {\r\n    app.render(<AppWs />)\r\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}